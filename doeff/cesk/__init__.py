"""
CESK Machine package for the doeff effect interpreter.

This package implements a unified multi-task CESK machine with:
- CESKState: Pure computation state (all tasks in one immutable object)
- TaskState: Individual task state
- Handlers: Pure functions that directly manipulate continuations
- Runtime: Scheduling, coordination, handles Requests
"""

from doeff.cesk.types import (
    Environment,
    FutureHandle,
    FutureId,
    SpawnHandle,
    SpawnId,
    Store,
    TaskHandle,
    TaskId,
)
from doeff.cesk.frames import (
    ContinueWithError,
    ContinueWithValue,
    Frame,
    FrameProtocol,
    FrameResult,
    GatherFrame,
    InterceptFrame,
    JoinFrame,
    Kontinuation,
    ListenFrame,
    LocalFrame,
    PopFrame,
    PushProgram,
    RaceFrame,
    ReturnFrame,
    SafeFrame,
)
from doeff.cesk.state import (
    AwaitExternalRequest,
    BlockedStatus,
    CESKState,
    Condition,
    Control,
    CreateFutureRequest,
    CreateSpawnRequest,
    CreateTaskRequest,
    DoneStatus,
    EffectControl,
    Error,
    ErrorControl,
    FutureCondition,
    PerformIORequest,
    ProgramControl,
    ReadyStatus,
    Request,
    RequestingStatus,
    ResolveFutureRequest,
    SpawnCondition,
    TaskCondition,
    TaskState,
    TaskStatus,
    TimeCondition,
    Value,
    ValueControl,
)
from doeff.cesk.step import (
    Handler,
    InterpreterInvariantError,
    StepError,
    UnhandledEffectError,
    step,
    to_generator,
)
from doeff.cesk.kontinuation import (
    pop_frame,
    push_frame,
    resume_kontinuation,
    throw_kontinuation,
)
from doeff.cesk.handlers import (
    default_handlers,
    handle_ask,
    handle_await,
    handle_cache_delete,
    handle_cache_exists,
    handle_cache_get,
    handle_cache_put,
    handle_delay,
    handle_gather,
    handle_get,
    handle_get_time,
    handle_intercept,
    handle_io,
    handle_join,
    handle_listen,
    handle_local,
    handle_modify,
    handle_pure,
    handle_put,
    handle_race,
    handle_safe,
    handle_task,
    handle_tell,
    handle_wait_until,
)
from doeff.cesk.runtime import (
    BaseRuntime,
    RuntimeProtocol,
    SimulationRuntime,
    SyncRuntime,
)

__all__ = [
    "Environment",
    "FutureHandle",
    "FutureId",
    "SpawnHandle",
    "SpawnId",
    "Store",
    "TaskHandle",
    "TaskId",
    "ContinueWithError",
    "ContinueWithValue",
    "Frame",
    "FrameProtocol",
    "FrameResult",
    "GatherFrame",
    "InterceptFrame",
    "JoinFrame",
    "Kontinuation",
    "ListenFrame",
    "LocalFrame",
    "PopFrame",
    "PushProgram",
    "RaceFrame",
    "ReturnFrame",
    "SafeFrame",
    "AwaitExternalRequest",
    "BlockedStatus",
    "CESKState",
    "Condition",
    "Control",
    "CreateFutureRequest",
    "CreateSpawnRequest",
    "CreateTaskRequest",
    "DoneStatus",
    "EffectControl",
    "Error",
    "ErrorControl",
    "FutureCondition",
    "PerformIORequest",
    "ProgramControl",
    "ReadyStatus",
    "Request",
    "RequestingStatus",
    "ResolveFutureRequest",
    "SpawnCondition",
    "TaskCondition",
    "TaskState",
    "TaskStatus",
    "TimeCondition",
    "Value",
    "ValueControl",
    "Handler",
    "InterpreterInvariantError",
    "StepError",
    "UnhandledEffectError",
    "step",
    "to_generator",
    "pop_frame",
    "push_frame",
    "resume_kontinuation",
    "throw_kontinuation",
    "default_handlers",
    "handle_ask",
    "handle_await",
    "handle_cache_delete",
    "handle_cache_exists",
    "handle_cache_get",
    "handle_cache_put",
    "handle_delay",
    "handle_gather",
    "handle_get",
    "handle_get_time",
    "handle_intercept",
    "handle_io",
    "handle_join",
    "handle_listen",
    "handle_local",
    "handle_modify",
    "handle_pure",
    "handle_put",
    "handle_race",
    "handle_safe",
    "handle_task",
    "handle_tell",
    "handle_wait_until",
    "BaseRuntime",
    "RuntimeProtocol",
    "SimulationRuntime",
    "SyncRuntime",
]
